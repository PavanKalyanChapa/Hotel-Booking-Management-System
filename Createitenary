import React, { useState } from "react";
import axios from "axios";

const CreateItinerary = () => {
  const [itinerary, setItinerary] = useState({
    id: "",
    destinationId: "",
    destination: "",
    duration: "",
    activities: "",
    lodging: "",
    dining: "",
  });

  const handleChange = (e) => {
    const { name, value } = e.target;
    setItinerary({ ...itinerary, [name]: value });
  };

  const handleSubmit = async (e) => {
    e.preventDefault();

    // Convert activities from comma-separated string â†’ array
    const formattedItinerary = {
      ...itinerary,
      id: Number(itinerary.id),
      destinationId: Number(itinerary.destinationId),
      activities: itinerary.activities.split(",").map((a) => a.trim()),
    };

    try {
      await axios.post("http://localhost:5000/api/itineraries", formattedItinerary);
      alert("Itinerary created successfully!");
      setItinerary({
        id: "",
        destinationId: "",
        destination: "",
        duration: "",
        activities: "",
        lodging: "",
        dining: "",
      });
    } catch (error) {
      console.error("Error creating itinerary:", error);
      alert("Failed to create itinerary");
    }
  };

  return (
    <div style={{ maxWidth: "500px", margin: "auto" }}>
      <h2>Create Itinerary</h2>
      <form onSubmit={handleSubmit}>
        <input
          type="number"
          name="id"
          placeholder="Itinerary ID"
          value={itinerary.id}
          onChange={handleChange}
          required
        />
        <br />
        <input
          type="number"
          name="destinationId"
          placeholder="Destination ID"
          value={itinerary.destinationId}
          onChange={handleChange}
          required
        />
        <br />
        <input
          type="text"
          name="destination"
          placeholder="Destination Name"
          value={itinerary.destination}
          onChange={handleChange}
        />
        <br />
        <input
          type="text"
          name="duration"
          placeholder="Duration (e.g., 7 days)"
          value={itinerary.duration}
          onChange={handleChange}
        />
        <br />
        <input
          type="text"
          name="activities"
          placeholder="Activities (comma separated)"
          value={itinerary.activities}
          onChange={handleChange}
        />
        <br />
        <input
          type="text"
          name="lodging"
          placeholder="Lodging"
          value={itinerary.lodging}
          onChange={handleChange}
        />
        <br />
        <input
          type="text"
          name="dining"
          placeholder="Dining"
          value={itinerary.dining}
          onChange={handleChange}
        />
        <br />
        <button type="submit">Create Itinerary</button>
      </form>
    </div>
  );
};

export default CreateItinerary;
